<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oasis Cannabis Products Admin</title>
  <!-- Load Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-storage-compat.js"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
  <style>
    /* Base and widget styles similar to index.html */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; line-height: 1.6; }
    .products-container { padding: 20px; position: relative; margin-bottom: 20px; }
    .scroll-arrow {
      position: absolute; top: 50%; transform: translateY(-50%);
      background: rgba(0,0,0,0.5); color: #fff; border: none;
      border-radius: 50%; width: 40px; height: 40px; cursor: pointer;
      z-index: 10; display: none;
    }
    .products-container:hover .scroll-arrow { display: block; }
    .scroll-arrow.left-arrow { left: 10px; }
    .scroll-arrow.right-arrow { right: 10px; }
    .products-scroll {
      display: flex; gap: 20px; overflow-x: auto;
      scroll-behavior: smooth; padding-bottom: 20px; cursor: grab;
    }
    .product-card {
      position: relative; flex: 0 0 350px;
      background: #fff; border-radius: 12px; padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: flex; flex-direction: column; text-decoration: none;
      color: inherit; min-height: 500px; transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.15); }
    .product-header { margin-bottom: 10px; }
    .product-title { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
    .product-price-box { display: inline-block; padding: 5px 10px; border: 2px solid #000; background: #fff; border-radius: 4px; }
    .product-image-container { height: 280px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
    .product-image { max-width: 100%; max-height: 100%; object-fit: contain; }
    .strain-indica { background: #d1c4e9; color: #fff; padding: 4px 8px; border-radius: 4px; }
    .thc-badge, .cbd-badge {
      display: inline-block; padding: 6px 12px; border-radius: 20px;
      font-size: 14px; font-weight: 500; background: #f1f1f1; color: #333;
      border: 1px solid #ddd; margin-right: 5px;
    }
    .add-to-cart { background: #000; color: #fff; border: none; border-radius: 6px;
      padding: 12px 15px; font-size: 15px; font-weight: 500; cursor: pointer;
      margin-top: auto; transition: background 0.2s;
    }
    .add-to-cart:hover { background: #333; }
    .product-icon {
      position: absolute; top: 10px; right: 10px; width: 50px; height: 50px;
      background: #fff; border-radius: 50%; overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex; align-items: center; justify-content: center;
    }
    .product-icon img { max-width: 100%; max-height: 100%; object-fit: contain; }
    /* Admin Interface Specific Styles */
    /* Hide the public admin trigger (not used here) */
    #admin-trigger { display: none; }
    /* Login and admin panel modals */
    #admin-login, #admin-panel { display: none; }
    #admin-login {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.85); padding: 30px;
      border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      z-index: 11000; width: 300px; color: #fff;
    }
    #admin-login h3 { margin-bottom: 15px; }
    #admin-login input { width: 100%; padding: 8px; margin-bottom: 10px;
      border: 1px solid #ddd; border-radius: 4px;
    }
    #admin-login button { width: 48%; padding: 8px; border: none; border-radius: 4px; cursor: pointer; }
    #admin-login button.primary { background: #333; color: #fff; }
    #admin-login button.secondary { background: #777; color: #fff; }
    #admin-panel {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85); z-index: 10500;
      display: flex; justify-content: center; align-items: center; overflow: hidden;
    }
    .admin-container {
      background: #fff; max-width: 800px; width: 90%; padding: 20px;
      border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      color: #333; max-height: 90vh; overflow-y: auto;
    }
    .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .admin-header h2 { font-size: 24px; }
    .admin-close { background: none; border: none; font-size: 28px; cursor: pointer; color: #333; }
    .admin-form { background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .admin-form .form-row { margin-bottom: 15px; }
    .admin-form label { display: block; margin-bottom: 5px; font-weight: 600; }
    .admin-form input, .admin-form select, .admin-form textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 15px;
    }
    .form-row-inline { display: flex; gap: 15px; flex-wrap: wrap; }
    .admin-button { background: #333; color: #fff; border: none; padding: 10px 15px;
      cursor: pointer; border-radius: 4px; font-size: 15px; font-weight: 600;
    }
    .admin-button.secondary { background: #777; }
    .admin-button:hover { opacity: 0.9; }
    .edit-mode-notice { background: #f1f1f1; padding: 10px; border-left: 4px solid #333;
      margin-bottom: 15px; display: none; color: #333;
    }
    .products-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .products-table th, .products-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    .products-table th { background: #f5f5f5; }
    @media (max-width: 768px) {
      .product-card { flex: 0 0 90%; min-height: 450px; }
      .products-scroll { gap: 15px; }
      .admin-container { width: 95%; padding: 15px; }
    }
  </style>
</head>
<body>
  <!-- Optional: Public Products Preview (appears at top) -->
  <div class="products-container">
    <button class="scroll-arrow left-arrow" onclick="scrollLeft()">
      <i class="fa fa-arrow-left"></i>
    </button>
    <div class="products-scroll" id="products-display">
      <div id="loading-products" style="width:100%; text-align:center;">Loading products...</div>
    </div>
    <button class="scroll-arrow right-arrow" onclick="scrollRight()">
      <i class="fa fa-arrow-right"></i>
    </button>
  </div>
  
  <!-- Admin Login Modal -->
  <div id="admin-login">
    <h3>Admin Login</h3>
    <div class="form-row">
      <label for="admin-password">Password:</label>
      <input type="password" id="admin-password" placeholder="Enter password" />
    </div>
    <div style="display: flex; justify-content: space-between;">
      <button class="admin-button primary" onclick="checkAdminPassword()">Login</button>
      <button class="admin-button secondary" onclick="closeAdminLogin()">Cancel</button>
    </div>
    <div id="admin-messages"></div>
  </div>
  
  <!-- Admin Panel Modal -->
  <div id="admin-panel">
    <div class="admin-container">
      <div class="admin-header">
        <h2>Manage Products</h2>
        <button class="admin-close" onclick="closeAdminPanel()">&times;</button>
      </div>
      <div id="admin-messages"></div>
      <div class="edit-mode-notice" id="edit-notice">
        You are editing a product. Make changes and click "Save Changes" or "Cancel".
      </div>
      <div class="admin-form" id="admin-form">
        <!-- Form Fields for Adding/Editing -->
        <div class="form-row">
          <label for="product-title-admin">Product Title</label>
          <input type="text" id="product-title-admin" placeholder="Enter product title" />
        </div>
        <div class="form-row">
          <label for="product-price-admin">Price</label>
          <input type="text" id="product-price-admin" placeholder="e.g., $19.99" />
        </div>
        <div class="form-row">
          <label for="product-name-admin">Product Name</label>
          <input type="text" id="product-name-admin" placeholder="e.g., Blue Dream" />
        </div>
        <div class="form-row-inline">
          <div class="form-row">
            <label for="strain-type-admin">Strain Type</label>
            <select id="strain-type-admin">
              <option value="indica">Indica</option>
              <option value="sativa">Sativa</option>
              <option value="hybrid">Hybrid</option>
            </select>
          </div>
          <div class="form-row">
            <label for="thc-content-admin">THC %</label>
            <input type="text" id="thc-content-admin" placeholder="e.g., 21.5%" />
          </div>
          <div class="form-row">
            <label for="cbd-content-admin">CBD %</label>
            <input type="text" id="cbd-content-admin" placeholder="e.g., 0.5%" />
          </div>
        </div>
        <div class="form-row">
          <label for="product-icon-admin">Product Icon (Upload your own)</label>
          <input type="file" id="product-icon-admin" accept="image/*" onchange="handleIconUploadAdmin(event)" />
          <div id="upload-progress-icon" style="display:none;">
            <div id="upload-progress-bar-icon"></div>
          </div>
          <div id="image-preview-icon-admin">
            <div>Icon preview will appear here</div>
          </div>
        </div>
        <div class="form-row">
          <label for="product-image-admin">Product Image</label>
          <input type="file" id="product-image-admin" accept="image/*" onchange="handleImageUploadAdmin(event)" />
          <div id="upload-progress" style="display:none;">
            <div id="upload-progress-bar"></div>
          </div>
          <div id="image-preview-admin">
            <div>Image preview will appear here</div>
          </div>
        </div>
        <!-- Hidden Fields for Uploaded URLs -->
        <input type="hidden" id="product-image-data-admin" value="" />
        <input type="hidden" id="product-icon-data-admin" value="" />
        <div style="display: flex; gap: 10px; margin-top: 15px;">
          <button class="admin-button primary" id="submit-btn" onclick="submitProductAdmin()">Add Product</button>
          <button class="admin-button secondary" id="cancel-btn" onclick="cancelEditAdmin()" style="display:none;">Cancel</button>
        </div>
      </div>
      <h3>Current Products</h3>
      <table class="products-table">
        <thead>
          <tr>
            <th>Product Title</th>
            <th>Strain Type</th>
            <th>THC/CBD</th>
            <th>Image</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="products-table">
          <tr><td colspan="5" style="text-align:center;">Loading products...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Firebase and Admin Scripts -->
  <script>
    // --- Initialize Firebase (ensure it only runs once) ---
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey: "AIzaSyASVWyRn-xBHh_BQvOAMQ0R24mnFtqE-eU",
        authDomain: "occwebimages.firebaseapp.com",
        databaseURL: "https://occwebimages-default-rtdb.firebaseio.com",
        projectId: "occwebimages",
        storageBucket: "occwebimages.firebasestorage.app",
        messagingSenderId: "86677569795",
        appId: "1:86677569795:web:1a854a6778bd9f7c0aa936"
      });
    }
    const db = firebase.database();
    const storage = firebase.storage();

    // --- Utility Functions ---
    function disableBackgroundScroll() { document.body.style.overflow = "hidden"; }
    function enableBackgroundScroll() { document.body.style.overflow = ""; }
    
    // --- Render Public Products (Optional Preview on Admin Page) ---
    function renderPublicProducts() {
      const container = document.getElementById("products-display");
      container.innerHTML = '<div id="loading-products" style="width:100%; text-align:center;">Loading products...</div>';
      const productsRef = db.ref('products');
      productsRef.orderByChild('createdAt').on('value', function(snapshot) {
        if (!snapshot.exists()) {
          container.innerHTML = '<div style="width:100%; text-align:center;">No products available</div>';
          return;
        }
        let products = [];
        snapshot.forEach(function(childSnapshot) {
          products.push({ id: childSnapshot.key, ...childSnapshot.val() });
        });
        products.sort(function(a, b){ return (b.createdAt || 0) - (a.createdAt || 0); });
        let html = "";
        products.forEach(function(product) {
          const strainType = product.strainType || "indica";
          const strainLabel = strainType.charAt(0).toUpperCase() + strainType.slice(1);
          html += `<a href="https://oasiscannabisnm.com/find-us" class="product-card">`;
          if (product.iconData && product.iconData.trim() !== "") {
            html += `<div class="product-icon"><img src="${product.iconData}" alt="Icon"></div>`;
          }
          html += `<div class="product-header"><h3 class="product-title">${product.title || product.name || "Unnamed Product"}</h3>`;
          if (product.price) {
            html += `<div class="product-price-box"><span class="product-price">Price: ${product.price}</span></div>`;
          }
          html += `</div>`;
          html += `<div class="product-image-container">`;
          if (product.imageData) {
            html += `<img src="${product.imageData}" alt="${product.name}" class="product-image">`;
          } else {
            html += `<div style="width:150px; height:150px; background:#f5f5f5; border-radius:10px; display:flex; align-items:center; justify-content:center;">
                        <i class="fa fa-image" style="font-size:50px; color:#aaa;"></i>
                      </div>`;
          }
          html += `</div>`;
          html += `<div class="product-info"><span class="strain-${strainType}">${strainLabel}</span>`;
          if (product.thcContent) { html += `<span class="thc-badge">THC: ${product.thcContent}</span>`; }
          if (product.cbdContent) { html += `<span class="cbd-badge">CBD: ${product.cbdContent}</span>`; }
          html += `</div>`;
          html += `<button class="add-to-cart" onclick="event.preventDefault();">Add to Cart</button>`;
          html += `</a>`;
        });
        container.innerHTML = html;
      }, function(error) {
        container.innerHTML = `<div style="width:100%; text-align:center; color:red;">Error: ${error.message}</div>`;
      });
    }
    renderPublicProducts();
    
    function scrollLeft() {
      document.getElementById("products-display").scrollBy({ left: -300, behavior: 'smooth' });
    }
    function scrollRight() {
      document.getElementById("products-display").scrollBy({ left: 300, behavior: 'smooth' });
    }
    document.addEventListener("DOMContentLoaded", function() {
      const slider = document.getElementById("products-display");
      let isDown = false, startX, scrollLeftPos;
      slider.addEventListener('mousedown', function(e) {
        isDown = true;
        startX = e.pageX - slider.offsetLeft;
        scrollLeftPos = slider.scrollLeft;
      });
      slider.addEventListener('mouseleave', function() { isDown = false; });
      slider.addEventListener('mouseup', function() { isDown = false; });
      slider.addEventListener('mousemove', function(e) {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        const walk = (x - startX) * 2;
        slider.scrollLeft = scrollLeftPos - walk;
      });
    });
    
    // --- Admin Panel Functions ---
    let editingProductId = null;
    function openAdminLogin() {
      document.getElementById("admin-login").style.display = "block";
      disableBackgroundScroll();
    }
    function closeAdminLogin() {
      document.getElementById("admin-login").style.display = "none";
      enableBackgroundScroll();
    }
    function checkAdminPassword() {
      const password = document.getElementById("admin-password").value;
      if (password === "oasis2023") {
        document.getElementById("admin-login").style.display = "none";
        document.getElementById("admin-password").value = "";
        openAdminPanel();
      } else {
        showMessage("admin-messages", "Incorrect password!", "error");
      }
    }
    function openAdminPanel() {
      document.getElementById("admin-panel").style.display = "flex";
      disableBackgroundScroll();
      updateAdminTable();
    }
    function closeAdminPanel() {
      document.getElementById("admin-panel").style.display = "none";
      enableBackgroundScroll();
      cancelEditAdmin();
    }
    function showMessage(containerId, message, type = "info") {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      const msgDiv = document.createElement("div");
      msgDiv.style.padding = "10px";
      msgDiv.style.margin = "10px 0";
      msgDiv.style.borderRadius = "4px";
      msgDiv.style.fontWeight = "500";
      if(type === "error") { msgDiv.style.backgroundColor = "#ffebee"; msgDiv.style.color = "#c62828"; }
      else if(type === "success") { msgDiv.style.backgroundColor = "#e8f5e9"; msgDiv.style.color = "#2e7d32"; }
      else { msgDiv.style.backgroundColor = "#e3f2fd"; msgDiv.style.color = "#1565c0"; }
      msgDiv.textContent = message;
      container.appendChild(msgDiv);
      setTimeout(() => { msgDiv.remove(); }, 5000);
    }
    function updateAdminTable() {
      const tableBody = document.getElementById("products-table");
      tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Loading products...</td></tr>';
      const productsRef = db.ref('products');
      productsRef.orderByChild('createdAt').on('value', function(snapshot) {
        if (!snapshot.exists()) {
          tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No products available</td></tr>';
          return;
        }
        let products = [];
        snapshot.forEach(function(childSnapshot) {
          products.push({ id: childSnapshot.key, ...childSnapshot.val() });
        });
        products.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
        let html = "";
        products.forEach(function(product) {
          html += `<tr>
                    <td>${product.title || product.name || "Unnamed Product"}</td>
                    <td>${(product.strainType || "indica").charAt(0).toUpperCase() + (product.strainType || "indica").slice(1)}</td>
                    <td>THC: ${product.thcContent || "N/A"} | CBD: ${product.cbdContent || "N/A"}</td>
                    <td style="width:100px; text-align:center;">${product.imageData ? `<img src="${product.imageData}" alt="${product.name}" style="max-width:80px; max-height:80px;">` : "No image"}</td>
                    <td>
                      <button class="admin-button" onclick="editProductAdmin('${product.id}')">Edit</button>
                      <button class="admin-button secondary" onclick="deleteProductAdmin('${product.id}')">Delete</button>
                    </td>
                  </tr>`;
        });
        tableBody.innerHTML = html;
      }, function(error) {
        tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:red;">Error: ${error.message}</td></tr>`;
      });
    }
    function editProductAdmin(productId) {
      db.ref('products/' + productId).once('value')
      .then(function(snapshot) {
        if(snapshot.exists()){
          const product = snapshot.val();
          document.getElementById("product-title-admin").value = product.title || "";
          document.getElementById("product-price-admin").value = product.price || "";
          document.getElementById("product-name-admin").value = product.name || "";
          document.getElementById("strain-type-admin").value = product.strainType || "indica";
          document.getElementById("thc-content-admin").value = product.thcContent || "";
          document.getElementById("cbd-content-admin").value = product.cbdContent || "";
          document.getElementById("product-icon-data-admin").value = product.iconData || "";
          document.getElementById("product-image-data-admin").value = product.imageData || "";
          const previewImage = document.getElementById("image-preview-admin");
          previewImage.innerHTML = product.imageData ? `<img src="${product.imageData}" alt="${product.name}">` : '<div>No image uploaded</div>';
          const previewIcon = document.getElementById("image-preview-icon-admin");
          previewIcon.innerHTML = product.iconData ? `<img src="${product.iconData}" alt="Product Icon">` : '<div>No icon uploaded</div>';
          editingProductId = productId;
          document.getElementById("submit-btn").innerText = "Save Changes";
          document.getElementById("cancel-btn").style.display = "inline-block";
          document.getElementById("edit-notice").style.display = "block";
        } else {
          showMessage("admin-messages", "Product not found!", "error");
        }
      })
      .catch(function(error) {
        showMessage("admin-messages", "Error: " + error.message, "error");
      });
    }
    function deleteProductAdmin(productId) {
      if(confirm("Are you sure you want to delete this product?")){
        db.ref('products/' + productId).remove()
        .then(function(){
          showMessage("admin-messages", "Product deleted!", "success");
        })
        .catch(function(error){
          showMessage("admin-messages", "Error deleting product: " + error.message, "error");
        });
      }
    }
    function submitProductAdmin() {
      const title = document.getElementById("product-title-admin").value;
      const price = document.getElementById("product-price-admin").value;
      const name = document.getElementById("product-name-admin").value;
      const strainType = document.getElementById("strain-type-admin").value;
      const thcContent = document.getElementById("thc-content-admin").value;
      const cbdContent = document.getElementById("cbd-content-admin").value;
      const imageData = document.getElementById("product-image-data-admin").value;
      const iconData = document.getElementById("product-icon-data-admin").value;
      if(!name || !strainType) {
        showMessage("admin-messages", "Please fill in the Product Name and Strain Type.", "error");
        return;
      }
      const product = {
        title, price, name, strainType, thcContent, cbdContent, imageData, iconData,
        createdAt: firebase.database.ServerValue.TIMESTAMP
      };
      const productsRef = db.ref('products');
      if(editingProductId) {
        productsRef.child(editingProductId).update(product)
        .then(function(){
          showMessage("admin-messages", "Product updated successfully!", "success");
          resetAdminForm();
        })
        .catch(function(error){
          showMessage("admin-messages", "Error updating product: " + error.message, "error");
        });
      } else {
        productsRef.push(product)
        .then(function(){
          showMessage("admin-messages", "Product added successfully!", "success");
          resetAdminForm();
        })
        .catch(function(error){
          showMessage("admin-messages", "Error adding product: " + error.message, "error");
        });
      }
    }
    function resetAdminForm() {
      document.getElementById("product-title-admin").value = "";
      document.getElementById("product-price-admin").value = "";
      document.getElementById("product-name-admin").value = "";
      document.getElementById("strain-type-admin").value = "indica";
      document.getElementById("thc-content-admin").value = "";
      document.getElementById("cbd-content-admin").value = "";
      document.getElementById("product-icon-data-admin").value = "";
      document.getElementById("product-image-admin").value = "";
      document.getElementById("product-image-data-admin").value = "";
      document.getElementById("image-preview-admin").innerHTML = '<div>Image preview will appear here</div>';
      document.getElementById("image-preview-icon-admin").innerHTML = '<div>Icon preview will appear here</div>';
      editingProductId = null;
      document.getElementById("submit-btn").innerText = "Add Product";
      document.getElementById("cancel-btn").style.display = "none";
      document.getElementById("edit-notice").style.display = "none";
    }
    function cancelEditAdmin() { resetAdminForm(); }
    
    // --- File Upload Handlers ---
    function handleImageUploadAdmin(event) {
      const file = event.target.files[0];
      if(!file) {
        showMessage("admin-messages", "Please select an image file.", "error");
        return;
      }
      const progressBar = document.getElementById("upload-progress-bar");
      const progressContainer = document.getElementById("upload-progress");
      progressContainer.style.display = "block";
      progressBar.style.width = "0%";
      showMessage("admin-messages", "Uploading product image...", "info");
      const timestamp = new Date().getTime();
      const fileName = `productImages/${timestamp}_${file.name}`;
      const storageRef = storage.ref().child(fileName);
      const uploadTask = storageRef.put(file);
      uploadTask.on('state_changed',
        function(snapshot){
          const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          progressBar.style.width = progress + "%";
        },
        function(error){
          progressContainer.style.display = "none";
          showMessage("admin-messages", "Image upload failed: " + error.message, "error");
        },
        function(){
          uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){
            document.getElementById("product-image-data-admin").value = downloadURL;
            document.getElementById("image-preview-admin").innerHTML = `<img src="${downloadURL}" alt="Product Image">`;
            setTimeout(function(){ progressContainer.style.display = "none"; }, 1000);
            showMessage("admin-messages", "Product image uploaded successfully!", "success");
          }).catch(function(error){
            showMessage("admin-messages", "Error getting image URL: " + error.message, "error");
          });
        }
      );
    }
    function handleIconUploadAdmin(event) {
      const file = event.target.files[0];
      if(!file) {
        showMessage("admin-messages", "Please select an icon file.", "error");
        return;
      }
      const progressBar = document.getElementById("upload-progress-bar-icon");
      const progressContainer = document.getElementById("upload-progress-icon");
      progressContainer.style.display = "block";
      progressBar.style.width = "0%";
      showMessage("admin-messages", "Uploading product icon...", "info");
      const timestamp = new Date().getTime();
      const fileName = `productImages/${timestamp}_icon_${file.name}`;
      const storageRef = storage.ref().child(fileName);
      const uploadTask = storageRef.put(file);
      uploadTask.on('state_changed',
        function(snapshot){
          const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          progressBar.style.width = progress + "%";
        },
        function(error){
          progressContainer.style.display = "none";
          showMessage("admin-messages", "Icon upload failed: " + error.message, "error");
        },
        function(){
          uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){
            document.getElementById("product-icon-data-admin").value = downloadURL;
            document.getElementById("image-preview-icon-admin").innerHTML = `<img src="${downloadURL}" alt="Product Icon">`;
            setTimeout(function(){ progressContainer.style.display = "none"; }, 1000);
            showMessage("admin-messages", "Product icon uploaded successfully!", "success");
          }).catch(function(error){
            showMessage("admin-messages", "Error getting icon URL: " + error.message, "error");
          });
        }
      );
    }
  </script>
</body>
</html>
